<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html><head>

  <style>
    body { line-height: 1.35;
           max-width: 960px;
           %(body_style)s }
    body .slidoc-toc-container { line-height: 1.6; }
    pre { padding: 0px 2em;}
    .slidoc-notes { padding: 0px 1em; font-size: 90%%; }
    .slidoc-notes p {margin: 0.3em 0;}
    .slidoc-clickable { padding: 0.3em 0 0 0; color: blue; text-decoration: underline; }
    .slidoc-clickable.slidoc-toc-entry { padding: 0.3em 0 0 1em; }
  </style>

 %(math_js)s

  <script>
     function slidocScrollTop() {
        window.scroll(0, 0);
     }

     function slidocGetParameter(name, number) {
        // Set number to true, if expecting an integer value. Returns null if valid parameter is not present
        var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
        if (!match)
           return null;
        var value = decodeURIComponent(match[1].replace(/\+/g, ' '));
        if (number) {
            try { value = parseInt(value); } catch(err) { value = null };
        }
        return value;
     }

     function slidocClassDisplay(className, displayValue) {
        // Set display value (string) for all elements with class
        // If !displayValue, toggle it
        var elements = document.getElementsByClassName(className);
        for (var i = 0; i < elements.length; ++i) {
          if (displayValue)
             elements[i].style.display = displayValue;
          else
             elements[i].style.display = (elements[i].style.display=='block') ? 'none' : 'block'
        }
     }

     function slidocIdDisplay(idValue, displayValue) {
        // Set display value (string) for element with it
        // If !displayValue, toggle it
         var element = document.getElementById(idValue);
         if (displayValue)
           element.style.display = displayValue;
         else
           element.style.display = (element.style.display=='block') ? 'none' : 'block';
     }

     function slidocToggleInline(elem) {
        var elements = elem.children;
        for (var i = 0; i < elements.length; ++i) {
           elements[i].style.display = (elements[i].style.display=='inline') ? 'none' : 'inline';
        }
     }

     function slidocChoiceClick(elem, slide_id, question_number, choice_val) {
        console.log("slidocChoiceClick:", slide_id, question_number, choice_val);
        if (question_number in Slidoc.questions_answered)
           return;
        Slidoc.questions_answered[question_number] = choice_val;

        elem.style['text-decoration'] = 'line-through';
        var choices = document.getElementsByClassName(slide_id+"-choice");
        for (var i = 0; i < choices.length; ++i) {
           choices[i].removeAttribute("onclick");
           choices[i].classList.remove("slidoc-clickable");
        }
        var notes_id = slide_id+"-notes";
        toggleBlock(notes_id);
        var notes_elem = document.getElementById(notes_id);
        if (notes_elem) notes_elem.style.display = 'inline';
        var concept_elem = document.getElementById(slide_id+"-concepts");
        var concept_list = concept_elem ? concept_elem.textContent.split('; ') : ';';
        var ans_elem = document.getElementById(slide_id+"-answer");
        if (ans_elem) ans_elem.style.display = 'inline';
        var corr_elem = document.getElementById(slide_id+"-correct");
        if (corr_elem) {
           var corr_answer = corr_elem.textContent;
           console.log('slidocChoiceClick:corr', corr_answer, concept_list);
           if (corr_answer) {
               Slidoc.questions_count += 1;
               var corr_choice = document.getElementById(slide_id+"-choice-"+corr_answer);
               if (corr_choice) {
                corr_choice.style['text-decoration'] = '';
                corr_choice.style['font-weight'] = 'bold';
              }
              var resp_elem = document.getElementById(slide_id+"-resp");
              if (resp_elem && choice_val) {
                 if (choice_val == corr_answer)  {
                    Slidoc.questions_correct += 1;
                    resp_elem.innerHTML = " &#x2714;&nbsp; ("+Slidoc.questions_correct+"/"+Slidoc.questions_count+")";
                 } else {
                    resp_elem.innerHTML = " &#x2718;&nbsp; ("+Slidoc.questions_correct+"/"+Slidoc.questions_count+")";
                 }
               }
            }
        }
     }

     function slidocAnswerClick(elem, slide_id, question_number, choice_type) {
        console.log("slidocAnswerClick:", slide_id, choice_type);
        toggleInline(elem);
        if (choice_type) {
           var notes_id = slide_id+"-notes";
           var notes_link = document.getElementById(notes_id);
           if (notes_link) {
               // Display any notes associated with this question
               notes_link.style.display = "inline";
               toggleBlock(notes_id);
           }
        }
     }

     function slidocChainURL(taglist, curindex, newindex, chapters) {
        // Returns next/prev URL: /(prefix)(newtag0).html?index=1&taglist=...#newtag1
        // tag = fsuffix#id
        // If chapters is true, only #id is used.
        var suffix = ".html";
        var curcomps = taglist[curindex-1].split("#");
        var newcomps = taglist[newindex-1].split("#");
        var newsearch = location.search.replace('index='+curindex, 'index='+newindex);
        if (chapters)
           return location.pathname + newsearch + '#' + newcomps[1];
        var prefix = location.pathname.substr(0, location.pathname.length-(curcomps[0]+suffix).length);
        return prefix + newcomps[0] + suffix + newsearch + '#' + newcomps[1];
     }

    var Slidoc = {};
    Slidoc.questions_answered = {};
    Slidoc.questions_count = 0;
    Slidoc.questions_correct = 0;
     
     function slidocReady(event) {
         var chapter = slidocGetParameter('chapter', true);
         var tagindex = slidocGetParameter('tagindex', true);
         console.log("slidocReady:", tagindex);
         if (!tagindex)
           return;
         var tagid = location.hash.substr(1);
         var ichain_elem = document.getElementById(tagid+"-ichain");
         if (!ichain_elem)
            return;
         var tagconcept = slidocGetParameter('tagconcept') || '';
         var tagconceptref = slidocGetParameter('tagconceptref') || '';
         var taglist = (slidocGetParameter('taglist') || '').split(";");

         //TEST taglist = ['a#11', 'E#22', 'f#33'];  tagindex = 2; tagconcept="CONCEPT"; tagconceptref="CONCEPTREF";

         console.log("slidocReady2:", tagindex, tagconcept, tagconceptref, taglist);
         if (tagindex && taglist.length > 1) {
             ichain_elem.style.display = 'block';
             var concept_elem = document.getElementById(tagid+"-ichain-concept");
             concept_elem.href += tagconceptref;
             concept_elem.text += tagconcept;
             if (tagindex > 1) {
                var prev_elem = document.getElementById(tagid+"-ichain-prev");
                prev_elem.style.display = 'inline';
                prev_elem.href = slidocChainURL(taglist, tagindex, tagindex-1);
             }
             if (tagindex < taglist.length) {
                var next_elem = document.getElementById(tagid+"-ichain-next");
                next_elem.style.display = 'inline';
                next_elem.href = slidocChainURL(taglist, tagindex, tagindex+1);
             }
         }
     }

     document.onreadystatechange = function(event) {
         console.log('onreadystatechange:', document.readyState);
         if (document.readyState != "interactive")
           return;
         try {
            slidocReady();
         } catch(err) {console.log("slidocReady: ERROR", err);}
     }

  </script>

</head>
<body>

  <p id="%(first_id)s"></p>
  %(content)s

</body></html>
